(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{690:function(s,a,e){"use strict";e.r(a);var t=e(5),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("在 0.9.0.0 之后的 Kafka，出现了几个新变动，一个是在 Server 端增加了 GroupCoordinator 这个角色，另一个较大的变动是将 topic 的 offset 信息由之前存储在 zookeeper 上改为存储到一个特殊的 "),e("code",[s._v("topic（__consumer_offsets)")]),s._v("中(即broker 中)。\n下面的命令 参数"),e("code",[s._v("(--zookeeper localhost:2181)")]),s._v(" 替换为"),e("code",[s._v("(--bootstrap-server brokerhost)")])]),s._v(" "),e("p",[s._v("本文测试版本：kafka_2.11-2.2.0")]),s._v(" "),e("h2",{attrs:{id:"启动-kafka"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动-kafka"}},[s._v("#")]),s._v(" 启动 Kafka")]),s._v(" "),e("p",[s._v("后台常驻方式，带上参数 "),e("code",[s._v("-daemon")]),s._v("，如：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-server-start.sh -daemon /usr/local/kafka/config/server.properties\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("指定 JMX port 端口启动，指定 jmx，可以方便监控 Kafka 集群")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JMX_PORT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9991")]),s._v(" /usr/local/kafka/bin/kafka-server-start.sh -daemon /usr/local/kafka/config/server.properties\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"停止-kafka"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#停止-kafka"}},[s._v("#")]),s._v(" 停止 Kafka")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-server-stop.sh\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"topic"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#topic"}},[s._v("#")]),s._v(" Topic")]),s._v(" "),e("h3",{attrs:{id:"创建-topic"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建-topic"}},[s._v("#")]),s._v(" 创建 Topic")]),s._v(" "),e("p",[s._v("参数 "),e("code",[s._v("--topic")]),s._v(" 指定 Topic 名，"),e("code",[s._v("--partitions")]),s._v(" 指定分区数，"),e("code",[s._v("--replication-factor")]),s._v(" 指定备份数：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" --partitions "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" --topic "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("注意，如果配置文件 server.properties 指定了 Kafka 在 zookeeper 上的目录，则参数也要指定，否则会报无可用的 brokers（下面部分命令也有同样的情况），如：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-topics.sh --create --zookeeper localhost:2181/kafka --replication-factor "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" --partitions "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" --topic "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"列出所有-topic"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#列出所有-topic"}},[s._v("#")]),s._v(" 列出所有 Topic")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-topics.sh --list --zookeeper localhost:2181\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"查看-topic"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看-topic"}},[s._v("#")]),s._v(" 查看 Topic")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-topics.sh --describe --zookeeper localhost:2181 --topic "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"增加-topic-的-partition-数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#增加-topic-的-partition-数"}},[s._v("#")]),s._v(" 增加 Topic 的 partition 数")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-topics.sh --zookeeper localhost:2181 --alter --topic "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" --partitions "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"查看-topic-指定分区-offset-的最大值或最小值"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看-topic-指定分区-offset-的最大值或最小值"}},[s._v("#")]),s._v(" 查看 topic 指定分区 offset 的最大值或最小值")]),s._v(" "),e("p",[s._v("time 为 -1 时表示最大值，为 -2 时表示最小值：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-run-class.sh kafka.tools.GetOffsetShell --topic "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" --time -1 --broker-list "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9092 --partitions "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"删除-topic"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#删除-topic"}},[s._v("#")]),s._v(" 删除 Topic")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-topics.sh --zookeeper localhost:2181 --topic "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" --delete\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"生产消息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生产消息"}},[s._v("#")]),s._v(" 生产消息")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-console-producer.sh --broker-list localhost:9092 --topic "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"消费消息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#消费消息"}},[s._v("#")]),s._v(" 消费消息")]),s._v(" "),e("h3",{attrs:{id:"从头开始"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#从头开始"}},[s._v("#")]),s._v(" 从头开始")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" --from-beginning\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"从尾部开始"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#从尾部开始"}},[s._v("#")]),s._v(" 从尾部开始")]),s._v(" "),e("p",[s._v("从尾部开始取数据，必需要指定分区：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" --offset latest --partition "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"指定分区"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#指定分区"}},[s._v("#")]),s._v(" 指定分区")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" --offset latest --partition "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"取指定个数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#取指定个数"}},[s._v("#")]),s._v(" 取指定个数")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" --offset latest --partition "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" --max-messages "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"消费者-group"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#消费者-group"}},[s._v("#")]),s._v(" 消费者 Group")]),s._v(" "),e("h3",{attrs:{id:"指定-group"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#指定-group"}},[s._v("#")]),s._v(" 指定 Group")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -group test_group --from-beginning\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"消费者-group-列表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#消费者-group-列表"}},[s._v("#")]),s._v(" 消费者 Group 列表")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --list\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"查看-group-详情"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看-group-详情"}},[s._v("#")]),s._v(" 查看 Group 详情")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group test_group --describe\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("输出：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("Consumer group "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test_group'")]),s._v(" has no active members.\n\nTOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("               -               -               -\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CURRENT-OFFSET: 当前消费者群组最近提交的 offset，也就是消费者分区里读取的当前位置")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# LOG-END-OFFSET: 当前最高水位偏移量，也就是最近一个读取消息的偏移量，同时也是最近一个提交到集群的偏移量")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# LAG：消费者的 CURRENT-OFFSET 与 broker 的 LOG-END-OFFSET 之间的差距")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h3",{attrs:{id:"删除-group-中-topic"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#删除-group-中-topic"}},[s._v("#")]),s._v(" 删除 Group 中 Topic")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group test_group --topic "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" --delete\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"删除-group"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#删除-group"}},[s._v("#")]),s._v(" 删除 Group")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group test_group --delete\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"平衡-leader"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#平衡-leader"}},[s._v("#")]),s._v(" 平衡 leader")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-preferred-replica-election.sh --bootstrap-server localhost:9092\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"自带压测工具"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自带压测工具"}},[s._v("#")]),s._v(" 自带压测工具")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("/usr/local/kafka/bin/kafka-producer-perf-test.sh --topic "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" --num-records "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" --record-size "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" --throughput "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" --producer-props bootstrap.servers"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("localhost:9092\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);